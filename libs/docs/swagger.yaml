basePath: /api/v1
definitions:
  alert.Contact:
    properties:
      auto_apply:
        type: boolean
      channel_type:
        type: string
      config:
        $ref: '#/definitions/common.JSONMap'
      enabled:
        type: boolean
      id:
        items:
          type: integer
        type: array
      max_retry:
        type: integer
      name:
        type: string
      realm_name:
        type: string
      retry_delay:
        type: string
      send_resolved:
        type: boolean
      severities:
        items:
          type: string
        type: array
    type: object
  alert.Metadata:
    properties:
      datasource_name:
        type: string
      realm_name:
        type: string
      resource_name:
        type: string
      timestamp:
        description: 告警發送時間
        type: integer
    type: object
  alert.MetricRule:
    properties:
      category:
        type: string
      detection_type:
        type: string
      display_unit:
        type: string
      duration:
        type: string
      match_datasource_names:
        items:
          type: string
        type: array
      match_target_pattern:
        type: string
      metric_display_name:
        type: string
      metric_raw_name:
        type: string
      name:
        type: string
      operator:
        type: string
      raw_unit:
        type: string
      scale:
        type: number
      thresholds:
        $ref: '#/definitions/alert.Threshold'
      uid:
        type: string
    type: object
  alert.MetricValue:
    properties:
      timestamp:
        description: 數據發生時間
        type: integer
      value:
        type: number
    type: object
  alert.RuleContactResponse:
    properties:
      id:
        type: string
      name:
        type: string
      severities:
        items:
          type: string
        type: array
      type:
        type: string
    type: object
  alert.RuleResponse:
    properties:
      auto_apply:
        type: boolean
      contacts:
        items:
          $ref: '#/definitions/alert.RuleContactResponse'
        type: array
      crit_threshold:
        type: number
      duration:
        type: string
      enabled:
        type: boolean
      id:
        type: string
      info_threshold:
        type: number
      metric_rule:
        $ref: '#/definitions/alert.MetricRule'
      silence_period:
        type: string
      target:
        $ref: '#/definitions/alert.Target'
      times:
        type: integer
      warn_threshold:
        type: number
    type: object
  alert.Target:
    properties:
      category:
        type: string
      collection_interval:
        type: integer
      datasource_name:
        type: string
      id:
        items:
          type: integer
        type: array
      is_hidden:
        type: boolean
      partition_name:
        type: string
      realm_name:
        type: string
      reporting_interval:
        type: integer
      resource_name:
        type: string
    type: object
  alert.Threshold:
    properties:
      crit:
        type: number
      info:
        type: number
      warn:
        type: number
    type: object
  common.JSONMap:
    additionalProperties:
      type: string
    type: object
  controller.ManualNotifyRequest:
    properties:
      ruleIds:
        items:
          type: string
        type: array
    required:
    - ruleIds
    type: object
  models.AlertPayload:
    properties:
      data:
        additionalProperties:
          items:
            $ref: '#/definitions/alert.MetricValue'
          type: array
        description: 監控數據
        type: object
      metadata:
        $ref: '#/definitions/alert.Metadata'
        description: 告警元數據
    type: object
  models.ContactResponse:
    properties:
      auto_apply:
        type: boolean
      channel_type:
        type: string
      config:
        additionalProperties: true
        type: object
      enabled:
        type: boolean
      id:
        type: string
      max_retry:
        type: integer
      name:
        type: string
      retry_delay:
        type: string
      send_resolved:
        type: boolean
      severities:
        items:
          type: string
        type: array
    type: object
  models.MetricRuleOverview:
    properties:
      category:
        description: 指標規則類型
        type: string
      contact_count:
        description: 通知通道數量
        type: integer
      metric_rule_name:
        description: 指標規則名稱
        type: string
      metric_rule_uid:
        description: 指標規則UID
        type: string
      partition_count:
        description: 監控分區數量
        type: integer
      rule_count:
        description: 規則數量
        type: integer
      rules:
        description: 規則列表
        items:
          $ref: '#/definitions/alert.RuleResponse'
        type: array
      target_count:
        description: 監控對象數量
        type: integer
    type: object
  models.Response:
    properties:
      msg:
        type: string
      success:
        type: boolean
    type: object
  models.Rule:
    properties:
      auto_apply:
        type: boolean
      contacts:
        items:
          $ref: '#/definitions/alert.Contact'
        type: array
      create_type:
        type: string
      crit_threshold:
        type: number
      duration:
        type: string
      enabled:
        type: boolean
      id:
        items:
          type: integer
        type: array
      info_threshold:
        type: number
      metric_rule_uid:
        type: string
      realm_name:
        type: string
      silence_period:
        type: string
      target:
        $ref: '#/definitions/alert.Target'
      target_id:
        items:
          type: integer
        type: array
      times:
        type: integer
      warn_threshold:
        type: number
    type: object
  models.RuleResponse:
    properties:
      auto_apply:
        type: boolean
      contacts:
        items:
          $ref: '#/definitions/alert.RuleContactResponse'
        type: array
      crit_threshold:
        type: number
      duration:
        type: string
      enabled:
        type: boolean
      id:
        type: string
      info_threshold:
        type: number
      metric_rule:
        $ref: '#/definitions/alert.MetricRule'
      silence_period:
        type: string
      target:
        $ref: '#/definitions/alert.Target'
      times:
        type: integer
      warn_threshold:
        type: number
    type: object
  models.RuleState:
    properties:
      contact_counter:
        type: integer
      contact_state:
        type: string
      first_triggered_at:
        type: integer
      last_check_value:
        type: number
      last_triggered_at:
        type: integer
      last_triggered_log_id:
        items:
          type: integer
        type: array
      last_triggered_severity:
        type: string
      last_triggered_value:
        type: number
      rule_id:
        items:
          type: integer
        type: array
      silence_end_at:
        type: integer
      silence_start_at:
        type: integer
      state:
        type: string
    type: object
  models.Target:
    properties:
      category:
        type: string
      collection_interval:
        type: integer
      datasource_name:
        type: string
      id:
        items:
          type: integer
        type: array
      is_hidden:
        type: boolean
      partition_name:
        type: string
      realm_name:
        type: string
      reporting_interval:
        type: integer
      resource_name:
        type: string
    type: object
  models.TriggeredLog:
    properties:
      id:
        items:
          type: integer
        type: array
      last_triggered_at:
        type: integer
      metric_rule_uid:
        type: string
      notify_log_id:
        items:
          type: integer
        type: array
      notify_state:
        type: string
      partition_name:
        type: string
      realm_name:
        type: string
      resolved_at:
        type: integer
      resolved_notify_log_id:
        items:
          type: integer
        type: array
      resolved_notify_state:
        type: string
      resolved_value:
        type: number
      resource_name:
        type: string
      rule_id:
        items:
          type: integer
        type: array
      rule_snapshot:
        $ref: '#/definitions/common.JSONMap'
      rule_state_snapshot:
        $ref: '#/definitions/common.JSONMap'
      severity:
        type: string
      threshold:
        type: number
      triggered_at:
        description: first
        type: integer
      triggered_value:
        type: number
    type: object
  response.Response:
    properties:
      data: {}
      message:
        type: string
      status:
        type: integer
    type: object
host: localhost:8080
info:
  contact: {}
  description: 提供告警、通知、規則管理等功能
  title: Shared-lib API
  version: "1.0"
paths:
  /alert/contact:
    get:
      consumes:
      - application/json
      description: 取得所有聯絡人 [ID, Name, Type, Enabled]
      parameters:
      - description: created_at
        in: query
        name: cursor
        type: integer
      - description: 最大筆數
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            $ref: '#/definitions/response.Response'
        "400":
          description: 無效的 ID
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 獲取聯絡人列表
      tags:
      - Contact
    post:
      consumes:
      - application/json
      description: 新增一條聯絡人
      parameters:
      - description: 聯絡人內容
        in: body
        name: contact
        required: true
        schema:
          $ref: '#/definitions/models.ContactResponse'
      produces:
      - application/json
      responses:
        "201":
          description: 成功創建
          schema:
            $ref: '#/definitions/models.ContactResponse'
        "400":
          description: 請求內容無效
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 創建聯絡人
      tags:
      - Contact
  /alert/contact/{id}:
    delete:
      consumes:
      - application/json
      description: 根據 ID 刪除聯絡人
      parameters:
      - description: 聯絡人 ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 刪除成功
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: 無效的 ID
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 刪除聯絡人
      tags:
      - Contact
    get:
      consumes:
      - application/json
      description: 根據 ID 獲取特定的聯絡人
      parameters:
      - description: 聯絡人 ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            $ref: '#/definitions/models.ContactResponse'
        "400":
          description: 無效的 ID
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 獲取單一聯絡人
      tags:
      - Contact
    put:
      consumes:
      - application/json
      description: 根據 ID 更新聯絡人內容
      parameters:
      - description: 聯絡人 ID
        in: path
        name: id
        required: true
        type: integer
      - description: 聯絡人內容
        in: body
        name: contact
        required: true
        schema:
          $ref: '#/definitions/models.ContactResponse'
      produces:
      - application/json
      responses:
        "200":
          description: 成功更新
          schema:
            $ref: '#/definitions/models.ContactResponse'
        "400":
          description: 請求內容無效
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 更新聯絡人
      tags:
      - Contact
  /alert/contact/notify-methods:
    get:
      consumes:
      - application/json
      description: 取得所有通知方法
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            items:
              type: string
            type: array
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 獲取通知方法
      tags:
      - Contact
  /alert/contact/notify-options:
    get:
      consumes:
      - application/json
      description: 取得所有通知選項
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            items:
              type: string
            type: array
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 獲取通知選項
      tags:
      - Contact
  /alert/contact/test:
    post:
      consumes:
      - application/json
      description: 測試聯絡人是否能夠收到通知
      parameters:
      - description: 聯絡人內容
        in: body
        name: contact
        required: true
        schema:
          $ref: '#/definitions/models.ContactResponse'
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            $ref: '#/definitions/models.Response'
        "400":
          description: 請求內容無效
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 測試聯絡人
      tags:
      - Contact
  /alert/history:
    get:
      consumes:
      - application/json
      description: 取得所有告警歷史
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            items:
              items:
                $ref: '#/definitions/models.TriggeredLog'
              type: array
            type: array
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 獲取告警歷史列表
      tags:
      - Alert
  /alert/rule:
    get:
      consumes:
      - application/json
      description: 取得所有規則 [ID, Name, Type, Enabled]
      parameters:
      - description: created_at
        in: query
        name: cursor
        type: integer
      - description: 最大筆數
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            $ref: '#/definitions/response.Response'
        "400":
          description: 無效的 ID
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 獲取規則列表
      tags:
      - Rule
    post:
      consumes:
      - application/json
      description: 新增一條規則
      parameters:
      - description: 規則內容
        in: body
        name: rule
        required: true
        schema:
          $ref: '#/definitions/models.Rule'
      produces:
      - application/json
      responses:
        "201":
          description: 成功創建
          schema:
            $ref: '#/definitions/models.Rule'
        "400":
          description: 請求內容無效
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 創建規則
      tags:
      - Rule
  /alert/rule/{id}:
    delete:
      consumes:
      - application/json
      description: 根據 ID 刪除規則
      parameters:
      - description: 規則 ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 刪除成功
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: 無效的 ID
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 刪除規則
      tags:
      - Rule
    get:
      consumes:
      - application/json
      description: 根據 ID 獲取特定的規則
      parameters:
      - description: 規則 ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            $ref: '#/definitions/models.Rule'
        "400":
          description: 無效的 ID
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 獲取單一規則
      tags:
      - Rule
    put:
      consumes:
      - application/json
      description: 根據 ID 更新規則內容
      parameters:
      - description: 規則 ID
        in: path
        name: id
        required: true
        type: string
      - description: 規則內容
        in: body
        name: rule
        required: true
        schema:
          $ref: '#/definitions/models.Rule'
      produces:
      - application/json
      responses:
        "200":
          description: 成功更新
          schema:
            $ref: '#/definitions/models.Rule'
        "400":
          description: 請求內容無效
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 更新規則
      tags:
      - Rule
  /alert/rule/manual-notify:
    post:
      consumes:
      - application/json
      description: 手動觸發指定規則的通知
      parameters:
      - description: 手動通知請求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/controller.ManualNotifyRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 通知已觸發
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: 請求內容無效
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 手動觸發通知
      tags:
      - Rule
  /alert/rule/metric-rule-category-options:
    get:
      consumes:
      - application/json
      description: 取得所有告警規則
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            items:
              $ref: '#/definitions/models.Rule'
            type: array
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 獲取告警規則列表
      tags:
      - Alert
  /alert/rule/metric-rule-options/{category}:
    get:
      consumes:
      - application/json
      description: 取得所有告警規則
      parameters:
      - description: 規則類別
        in: path
        name: category
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            items:
              $ref: '#/definitions/models.Rule'
            type: array
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 獲取告警規則列表
      tags:
      - Alert
  /alert/rule/metric-rule/{uid}:
    get:
      consumes:
      - application/json
      description: 取得規則詳細
      parameters:
      - description: 規則 UID
        in: path
        name: uid
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            items:
              $ref: '#/definitions/models.Rule'
            type: array
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 獲取規則詳細
      tags:
      - Alert
  /alert/run-alert:
    post:
      consumes:
      - application/json
      description: 告警處理
      parameters:
      - description: 檢測數據
        in: body
        name: alertPayload
        required: true
        schema:
          $ref: '#/definitions/models.AlertPayload'
      responses:
        "200":
          description: 成功回應
          schema:
            $ref: '#/definitions/response.Response'
      summary: 告警處理
      tags:
      - Alert
  /alert/run-notify:
    post:
      consumes:
      - application/json
      description: 批次通知
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            $ref: '#/definitions/response.Response'
      summary: 立即通知
      tags:
      - Alert
  /alert/state:
    get:
      consumes:
      - application/json
      description: 取得所有告警狀態
      produces:
      - application/json
      responses:
        "200":
          description: 成功回應
          schema:
            items:
              $ref: '#/definitions/models.RuleState'
            type: array
        "500":
          description: 伺服器錯誤
          schema:
            $ref: '#/definitions/response.Response'
      security:
      - ApiKeyAuth: []
      summary: 獲取告警狀態列表
      tags:
      - Alert
  /api/v1/rules:
    get:
      consumes:
      - application/json
      description: 列出所有規則
      parameters:
      - description: 游標
        in: query
        name: cursor
        type: integer
      - description: 限制
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/response.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/models.MetricRuleOverview'
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/response.Response'
      summary: 列出規則
      tags:
      - rules
    post:
      consumes:
      - application/json
      description: 創建一個新的規則
      parameters:
      - description: 規則信息
        in: body
        name: rule
        required: true
        schema:
          $ref: '#/definitions/models.RuleResponse'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.RuleResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/response.Response'
      summary: 創建規則
      tags:
      - rules
  /api/v1/rules/{id}:
    delete:
      consumes:
      - application/json
      description: 刪除現有規則
      parameters:
      - description: 規則 ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/response.Response'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/response.Response'
      summary: 刪除規則
      tags:
      - rules
    put:
      consumes:
      - application/json
      description: 更新現有規則
      parameters:
      - description: 規則 ID
        in: path
        name: id
        required: true
        type: string
      - description: 規則信息
        in: body
        name: rule
        required: true
        schema:
          $ref: '#/definitions/models.RuleResponse'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.RuleResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/response.Response'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/response.Response'
      summary: 更新規則
      tags:
      - rules
  /api/v1/rules/{metricRuleUID}:
    get:
      consumes:
      - application/json
      description: 根據 metricRuleUID 獲取規則
      parameters:
      - description: 指標規則 UID
        in: path
        name: metricRuleUID
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.RuleResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/response.Response'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/response.Response'
      summary: 獲取規則
      tags:
      - rules
  /api/v1/rules/{metricRuleUID}/targets:
    get:
      consumes:
      - application/json
      description: 獲取可用的監控目標
      parameters:
      - description: 指標規則 UID
        in: path
        name: metricRuleUID
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/response.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/models.Target'
                  type: array
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/response.Response'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/response.Response'
      summary: 獲取可用的監控目標
      tags:
      - rules
securityDefinitions:
  ApiKeyAuth:
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
